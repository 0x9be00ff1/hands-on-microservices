wget https://storage.googleapis.com/kubernetes-helm/helm-v2.9.1-linux-amd64.tar.gz
tar -xvf ./helm-v2.9.1-linux-amd64.tar.gz
cd linux-amd64/



apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: tiller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
  - kind: ServiceAccount
    name: tiller
    namespace: kube-system

./helm init
./helm repo add coreos https://s3-eu-west-1.amazonaws.com/coreos-charts/stable/

helm install coreos/prometheus-operator --name prometheus-operator --namespace monitoring 
helm install coreos/kube-prometheus --name kube-prometheus --set global.rbacEnable=true --namespace monitoring

kubectl get pods --all-namespaces
NAMESPACE     NAME                                                   READY     STATUS    RESTARTS   AGE
kube-system   calico-etcd-xl2w6                                      1/1       Running   0          41m
kube-system   calico-kube-controllers-84fd4db7cd-4x6wd               1/1       Running   0          41m
kube-system   calico-node-5vzhr                                      2/2       Running   0          41m
kube-system   calico-node-867xc                                      2/2       Running   0          41m
kube-system   calico-node-bw55k                                      2/2       Running   0          41m
kube-system   coredns-78fcdf6894-cxw28                               1/1       Running   0          43m
kube-system   coredns-78fcdf6894-tck74                               1/1       Running   0          43m
kube-system   etcd-k8s1                                              1/1       Running   0          43m
kube-system   kube-apiserver-k8s1                                    1/1       Running   0          42m
kube-system   kube-controller-manager-k8s1                           1/1       Running   0          42m
kube-system   kube-proxy-6ps59                                       1/1       Running   0          43m
kube-system   kube-proxy-bng4p                                       1/1       Running   0          41m
kube-system   kube-proxy-cbt4r                                       1/1       Running   0          41m
kube-system   kube-scheduler-k8s1                                    1/1       Running   0          43m
kube-system   tiller-deploy-759cb9df9-qbq9f                          1/1       Running   0          35m
monitoring    alertmanager-kube-prometheus-0                         2/2       Running   0          4m
monitoring    kube-prometheus-exporter-kube-state-66b8849c9b-jbfdx   2/2       Running   0          3m
monitoring    kube-prometheus-exporter-node-2ctjh                    1/1       Running   0          4m
monitoring    kube-prometheus-exporter-node-6hwmf                    1/1       Running   0          4m
monitoring    kube-prometheus-exporter-node-wbhg6                    1/1       Running   0          4m
monitoring    kube-prometheus-grafana-f869c754-bmbkj                 2/2       Running   0          4m
monitoring    prometheus-kube-prometheus-0                           3/3       Running   1          4m
monitoring    prometheus-operator-858c485-wwf8z                      1/1       Running   0          34m

kubectl get service --all-namespaces
NAMESPACE     NAME                                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)               AGE
default       kubernetes                                         ClusterIP   10.96.0.1        <none>        443/TCP               45m
kube-system   calico-etcd                                        ClusterIP   10.96.232.136    <none>        6666/TCP              42m
kube-system   kube-dns                                           ClusterIP   10.96.0.10       <none>        53/UDP,53/TCP         45m
kube-system   kube-prometheus-exporter-kube-controller-manager   ClusterIP   None             <none>        10252/TCP             4m
kube-system   kube-prometheus-exporter-kube-dns                  ClusterIP   None             <none>        10054/TCP,10055/TCP   4m
kube-system   kube-prometheus-exporter-kube-etcd                 ClusterIP   None             <none>        4001/TCP              4m
kube-system   kube-prometheus-exporter-kube-scheduler            ClusterIP   None             <none>        10251/TCP             4m
kube-system   kubelet                                            ClusterIP   None             <none>        10250/TCP             32m
kube-system   tiller-deploy                                      ClusterIP   10.108.40.70     <none>        44134/TCP             41m
monitoring    alertmanager-operated                              ClusterIP   None             <none>        9093/TCP,6783/TCP     4m
monitoring    kube-prometheus                                    ClusterIP   10.106.190.190   <none>        9090/TCP              4m
monitoring    kube-prometheus-alertmanager                       ClusterIP   10.98.89.6       <none>        9093/TCP              4m
monitoring    kube-prometheus-exporter-kube-state                ClusterIP   10.102.37.201    <none>        80/TCP                4m
monitoring    kube-prometheus-exporter-node                      ClusterIP   10.97.69.196     <none>        9100/TCP              4m
monitoring    kube-prometheus-grafana                            ClusterIP   10.97.89.44      <none>        80/TCP                4m
monitoring    prometheus-operated                                ClusterIP   None             <none>        9090/TCP              4m

kubectl port-forward --namespace=monitoring kube-prometheus-grafana-f869c754-bmbkj 3000:3000

NAMESPACE     NAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kube-system   calico-kube-controllers               1         1         1            1           44m
kube-system   coredns                               2         2         2            2           46m
kube-system   tiller-deploy                         1         1         1            1           43m
monitoring    kube-prometheus-exporter-kube-state   1         1         1            1           6m
monitoring    kube-prometheus-grafana               1         1         1            1           6m
monitoring    prometheus-operator                   1         1         1            1           37m

kubectl port-forward --namespace=monitoring svc/kube-prometheus-grafana 8080:80

kubectl get deployment --all-namespaces
NAMESPACE     NAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kube-system   calico-kube-controllers               1         1         1            1           1h
kube-system   coredns                               2         2         2            2           1h
kube-system   tiller-deploy                         1         1         1            1           1h
monitoring    kube-prometheus-exporter-kube-state   1         1         1            1           1h
monitoring    kube-prometheus-grafana               1         1         1            1           1h
monitoring    prometheus-operator                   1         1         1            1           1h

kubectl port-forward --namespace=monitoring prometheus-kube-prometheus-0 9090:9090
