# 工具链

> 子曰：“工欲善其事，必先利其器。居是邦也，事其大夫之贤者，友其士之仁者。” 
> 
>                                                                                                                     -- 《论语》

普通话版：工匠想要做好工作，先要把工具打磨锋利。

程序员版：软件工程师要想写好代码，需要一把机械键盘，并定期清洗轴以维持最佳手感。

对于程序员而言，除了键盘等硬件，还有一系列软件。我们这里将这些软件称为工具链。

下面，让我们跟随小张 - 是的，就是在风口创业公司的那位 - 看看在微服务架构下，研发工具链包含了哪些内容。

## 研发工具链

| 时间    | 工作                             | 工具需求                           | 备注                     |
| ----- | ------------------------------ | ------------------------------ | ---------------------- |
| 09:01 | 打开浏览器，登录公司内网                   | 使用同一个账号，登录公司所有的内部系统。           | 暂不讨论“操作系统”、“浏览器”等通用软件。 |
| 09:03 | 打开代码审核平台，查看Review              | 代码版本控制、代码托管，代码审核               |                        |
| 10:23 | 老张让我升级下xx的包，加了新接口              | 版本依赖管理系统                       | 我们将开发语言暂时限定为Java       |
| 11:56 | 修改了一部分逻辑，午饭前抓紧提交上去，看能否跑通所有Case | 持续集成(Continuous integration)系统 | 暂不讨论“IDE”等通用软件。        |
| 15:20 | 功能开发完毕，上线！                     | 持续交付(Continuous delivery)系统    |                        |
| 16:03 | X功能重构，拆分到两个微服务中                | 微服务开发辅助工具                      |                        |

小张的公司还处于创业阶段，出于节省成本的考虑，我们尽量选择开(mian)源(fei)的解决方案：

1. 内部帐号统一管理：在企业的内部，存在许多内部系统。出于安全性、管理性的考虑，需要统一的帐号管理系统。这里我们选用[OpenLDAP](https://www.openldap.org/)：一款的开源的帐号管理服务，它实现了广泛使用的“轻量级目录管理协议”(LDAP v3)，可以轻松对接各类系统的帐号管理功能。

2. 代码管理：团队协作的软件开发模式，需要版本控制系统。我们选用了[Git](https://git-scm.com/)做为代码的版本控制系统。在代码的托管、审核方面，[Gerrit](https://www.gerritcodereview.com/)和[GitLab](https://about.gitlab.com/install/?version=ce)都是成熟的开源解决方案。Gitlab上手容易，生态链更加成熟；Gerrit有一定上手门槛，在代码Review方面更加优秀。关于两者的讨论，可以参考这篇[帖子](https://www.reddit.com/r/git/comments/8ekeem/do_you_use_gerrit_software/)。经过多方面的综合考虑，我们选择了GitLab。

3. 版本依赖系统：在Java开发中，[Maven](https://maven.apache.org/)是依赖管理的事实标准。同时在企业开发中，不希望将私有包发布到公开仓库中，我们选用[Nexus Repository OSS](https://www.sonatype.com/products/repository-oss)搭建私有的Maven仓库。

4. 持续集成、持续交付，持续部署是三个相近的概念，我们将在下一小节展开讨论。

5. 微服务辅助开发工具：在微服务架构下，新增微服务、升级pom版本，接口变更等操作会频繁发生。需要开发一些辅助工具，提升研发效率。我们会在后续章节展开讨论。

## 持续集成、持续交付、持续部署

标题中的三个词经常成对出现，[这篇](https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/)文章很好的阐述了他们的联系与区别。

我们还是以工程师小王举例：

### 持续集成

小王每次向gitlab提交一个代码，就会触发一次项目的自动构建、运行单元测试，这就是持续集成(Continuous Integration)。如下图所示：

![](./ci.png)

管理学大师戴明提出：“问题发现的越早，修复的成本越低”。假设小王在提交中引入了一个Bug，借助CI流程(中的集成 or 单元测试)，我们就能在第一时间发现，并尽早修复问题。

### 持续部署



### 持续交付



关于他们的区别，可以参考文章。简单来讲：集成侧重于快速构建和跑通单元测试；交付 = 构建 + 部署类生产系统(例如预发)，验证通过后手动部署上线；持续部署更进了一步：将持续构建中的“手动部署”转为自动执行，更加高效。我们将结合GitLab和[Jenkins](https://www.jenkins.io/)实现持续集成(CI)和持续交付(CD)。
